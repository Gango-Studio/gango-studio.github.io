<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é«˜ç²¾åº¦å…¼å®¹èŠ‚æ‹å™¨</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #f5f5f5;
            font-family: Arial, sans-serif;
            margin: 0;
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }

        .wheel-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin: 30px;
        }

        .control-wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(145deg, #f0f0f0, #ffffff);
            box-shadow: 8px 8px 16px #d9d9d9,
                      -8px -8px 16px #ffffff;
            cursor: pointer;
            touch-action: none;
            transition: transform 0.1s ease-out;
        }

        .center-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90px;
            height: 90px;
            background: #f8f8f8;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 3px 3px 6px #d9d9d9,
                      inset -3px -3px 6px #ffffff;
        }

        #bpm {
            font-size: 1.8em;
            font-weight: bold;
            color: #444;
        }

        button {
            margin: 20px;
            padding: 12px 30px;
            font-size: 1.1em;
            cursor: pointer;
            background: #f0f0f0;
            border: none;
            border-radius: 25px;
            box-shadow: 4px 4px 8px #d9d9d9,
                      -4px -4px 8px #ffffff;
            color: #444;
            transition: all 0.2s ease;
        }

        button:active {
            box-shadow: inset 2px 2px 4px #d9d9d9,
                      inset -2px -2px 4px #ffffff;
        }
    </style>
</head>
<body>
    <a href = "https://gango-studio.github.io" style="text-decoration: none;color:black"><div>
       <h1 align="center">Gango</h1>
</div></a>
 <br/>
 <br/>
 <h1 align = "center">GangoèŠ‚æ‹å™¨</h1>
    <br/>
    <br/>
    <div class="wheel-container">
        <div class="control-wheel"></div>
        <div class="center-display">
            <span id="bpm">120</span>
            <span>BPM</span>
        </div>
    </div>
    <button id="toggle">Start</button>
        <br/>
    <footer><div  style="background:#DCDCDC;heightï¼š100%;width:100%;"><br/></div><br/>
    <h3  style ="padding-left : 6%;widthï¼š100% ;height:100%">Gango Studio</h3>
    <h4 style = "widthï¼š100% ;height:100%"><a style ="color:black;text-decoration: none;padding-left : 10%;" href = "https://gango-studio.github.io">ğŸ ä¸»é¡µ</a></h4>
    <div  style ="padding-left : 10%;float:left;widthï¼š100% ;height:100%">
          <h5><a  style ="text-decoration: none;color:black;" href = "https://gango-studio.github.io/main.html">ğŸ”—Vlog</h5>
          <h5><a  style ="text-decoration: none;color:black;" href = "https://gango-studio.github.io/introduce/cfile.html">ğŸ”—C++</a></h5>
          <h5><a  style ="text-decoration: none;color:black;" href = "https://gango-studio.github.io/serves/tools/indexpage.html">ğŸ”—Gango Weather</a></h5>
    </div>
   <div style ="padding-left : 10%;float:left;widthï¼š100% ;height:100%">
          <h5><a  style ="text-decoration: none;color:black;" href = "https://gango-studio.github.io/introduce/blog.html">ğŸ”—Blog</a></h5>
          <h5><a  style ="text-decoration: none;color:black;" href = "https://gango-studio.github.io/serves/blank.html">ğŸ”—æµè§ˆå™¨ä¸»é¡µ</a></h5>
          <h5><a  style ="text-decoration: none;color:black;"  href = "https://gango-studio.github.io/serves/tools/indexpage.html">ğŸ”—Gango Tool</a></h5>
   </div>
</footer>
        <script>
        // é…ç½®é¡¹
        const CONFIG = {
            minBpm: 30,
            maxBpm: 300,
            baseBpm: 120,
            lookAhead: 0.1,    // é¢„æ’æ—¶é—´ï¼ˆç§’ï¼‰
            scheduleAhead: 0.2 // è°ƒåº¦æå‰é‡
        };

        // çŠ¶æ€ç®¡ç†
        let state = {
            isPlaying: false,
            rotation: 0,
            bpm: CONFIG.baseBpm,
            nextTickTime: 0,
            audioContext: null,
            audioBuffer: null,
            timerID: 0,
            lastTick: 0,
            useWebAudio: false
        };

        // åˆå§‹åŒ–éŸ³é¢‘
        async function initAudio() {
            try {
                state.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const response = await fetch('metronome.wav');
                const arrayBuffer = await response.arrayBuffer();
                state.audioBuffer = await state.audioContext.decodeAudioData(arrayBuffer);
                state.useWebAudio = true;
            } catch (e) {
                console.log('ä½¿ç”¨å…¼å®¹éŸ³é¢‘æ¨¡å¼');
                state.useWebAudio = false;
            }
        }

        // éŸ³é¢‘æ’­æ”¾
        function playTick() {
            if (state.useWebAudio) {
                const source = state.audioContext.createBufferSource();
                source.buffer = state.audioBuffer;
                source.connect(state.audioContext.destination);
                source.start(state.audioContext.currentTime);
            } else {
                const audio = new Audio('metronome.wav');
                audio.play().catch(() => {});
            }
        }

        // æ ¸å¿ƒè°ƒåº¦å™¨
        function scheduler() {
            if (!state.isPlaying) return;

            const now = performance.now();
            const interval = 60000 / state.bpm;
            const drift = now - state.nextTickTime;

            // è¯¯å·®è¡¥å¿ç®—æ³•
            if (drift > interval * 1.5) {
                state.nextTickTime = now;
            } else {
                state.nextTickTime += interval - Math.min(drift, interval/2);
            }

            // èŠ‚æ‹è§¦å‘
            if (now >= state.nextTickTime - CONFIG.scheduleAhead) {
                playTick();
                state.lastTick = now;
            }

            // åŠ¨æ€è°ƒæ•´è¯·æ±‚å‘¨æœŸ
            const nextInterval = Math.max(1, interval/2 - (now - state.lastTick));
            state.timerID = setTimeout(scheduler, nextInterval);
        }

        // BPMæ§åˆ¶ï¼ˆä¿æŒåŸæœ‰æ—‹è½¬é€»è¾‘ï¼‰
        function updateBpm(newBpm) {
            state.bpm = Math.max(CONFIG.minBpm, Math.min(CONFIG.maxBpm, newBpm));
            document.getElementById('bpm').textContent = state.bpm;
        }

        // æ§åˆ¶åˆ‡æ¢
        function toggleMetronome() {
            state.isPlaying = !state.isPlaying;
            document.getElementById('toggle').textContent = state.isPlaying ? 'Stop' : 'Start';
            
            if (state.isPlaying) {
                state.nextTickTime = performance.now();
                state.lastTick = state.nextTickTime;
                scheduler();
            } else {
                clearTimeout(state.timerID);
            }
        }

        // åˆå§‹åŒ–
        initAudio().then(() => {
            // äº‹ä»¶ç»‘å®šï¼ˆä¿æŒåŸæœ‰æ—‹è½¬äº‹ä»¶å¤„ç†ï¼‰
            document.getElementById('toggle').addEventListener('click', toggleMetronome);
        });

        // ç§»åŠ¨ç«¯é€‚é…ï¼ˆä¿æŒåŸæœ‰è§¦æ‘¸äº‹ä»¶å¤„ç†ï¼‰
    </script>

       
</body>
</html>
