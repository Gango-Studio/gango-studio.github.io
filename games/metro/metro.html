<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html style="filter: grayscale(0%);" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Simulator - Yamanote Line</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ÂÖ®Â±ÄÊ†∑Âºè */
        :root {
            --jr-green: #00a05b;
            --jr-red: #ed1c24;
            --jr-orange: #f58220;
            --jr-blue: #0068b7;
            --jr-yellow: #fff100;
        }
        
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f5f5f7;
            color: #1d1d1f;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        a {
            text-decoration: none;
            color: #007aff;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #005bb5;
        }

        /* È°µÈ¶ñÊ†∑Âºè */
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px 0;
            background-color: #ffffff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5em;
            margin: 0;
            color: #1d1d1f;
            font-weight: 500;
        }

        /* Ê∏∏ÊàèÂÆπÂô®Ê†∑Âºè */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: transparent;
            flex: 1;
        }

        /* Ê∏∏ÊàèÂå∫ÂüüÊ†∑Âºè */
        #game-area {
            position: relative;
            width: 100%;
            height: 300px;
            background-color: #333;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        #train {
            position: absolute;
            width: 150px;
            height: 50px;
            background-color: var(--jr-green);
            bottom: 50px;
            left: 50px;
            transition: transform 0.1s ease;
        }

        #station {
            position: absolute;
            width: 20px;
            height: 100px;
            background-color: white;
            bottom: 0;
            right: 200px;
        }

        #stop-zone {
            position: absolute;
            width: 60px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            bottom: 50px;
            right: 190px;
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background-color: var(--jr-green);
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #008a4f;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        #speed-control {
            width: 100%;
            margin-bottom: 20px;
        }

        #stats {
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .stat-box {
            text-align: center;
        }

        .stat-box h3 {
            margin: 0 0 5px;
            color: #666;
            font-size: 14px;
        }

        .stat-box p {
            margin: 0;
            font-size: 24px;
            font-weight: 500;
            color: #1d1d1f;
        }

        /* Ê∑ªÂä†ÈÄöÂÖ≥ÂºπÁ™óÊ†∑Âºè */
        #success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        #success-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
        }
        
        #success-image {
            max-width: 100%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        #close-modal {
            background-color: var(--jr-green);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        /* È°µËÑöÊ†∑Âºè */
        footer {
            width: 100%;
            background-color: #ffffff;
            padding: 20px 0;
            text-align: left;
            margin-top: auto;
            border-top: 1px solid #e0e0e0;
            display: flex;
            flex-wrap: wrap;
        }

        footer h3 {
            font-size: 1.8em;
            margin: 0;
            padding-left: 10%;
            color: #1d1d1f;
            font-weight: 500;
            width: 100%;
        }

        footer h4, footer h5 {
            margin: 0;
            padding: 5px 0;
            padding-left: 10%;
            color: #1d1d1f;
        }

        footer a {
            color: #1d1d1f;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        footer a:hover {
            color: #007aff;
        }

        footer div {
            width: 50%;
            box-sizing: border-box;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }

        .accuracy-clickable {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <header>
        <a href="https://gango-studio.github.io">
            <h1>Train Simulator - Yamanote Line</h1>
        </a>
    </header>

    <div class="game-container">
        <div id="game-area">
            <div id="train"></div>
            <div id="station"></div>
            <div id="stop-zone"></div>
        </div>

        <div id="controls">
            <button id="start-btn">Start</button>
            <button id="stop-btn" disabled>Stop</button>
            <button id="brake-btn" disabled>Brake</button>
            <button id="reset-btn">Reset</button>
        </div>

        <input type="range" id="speed-control" min="1" max="10" value="5" disabled>

        <div id="stats">
            <div class="stat-box">
                <h3>Speed</h3>
                <p id="speedValue">0</p>
            </div>
            <div class="stat-box">
                <h3>Distance</h3>
                <p id="distanceValue">0m</p>
            </div>
            <div class="stat-box">
                <h3>Score</h3>
                <p id="scoreValue">0</p>
            </div>
            <div class="stat-box accuracy-clickable" id="accuracy-box">
                <h3>Accuracy</h3>
                <p id="accuracyValue">0%</p>
            </div>
        </div>
    </div>

    <!-- ÈÄöÂÖ≥ÂºπÁ™ó -->
    <div id="success-modal">
        <div id="success-content">
            <h2>Congratulations!</h2>
            <p>You've achieved high-precision stopping!</p>
            <img id="success-image" src="../pic/metro.jpg" alt="Success Image">
            <button id="close-modal">Close</button>
        </div>
    </div>

    <footer>
        <h3>Gango Studio</h3>
        <div>
            <h4><a href="https://gango-studio.github.io">üè†Home</a></h4>
            <h5><a href="https://gango-studio.github.io/main.html">üîóVlog</a></h5>
            <h5><a href="https://gango-studio.github.io/introduce/cfile.html">üîóC++</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/tools/indexpage.html">üîóGango Weather</a></h5>
        </div>
        <div>
            <h5><a href="https://gango-studio.github.io/introduce/blog.html">üîóBlog</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/blank.html">üîóBrowser Home</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/tools/indexpage.html">üîóGango Tool</a></h5>
            <h5>&nbsp;<a></a></h5>
        </div>
    </footer>

    <script>
        // Ê∏∏Êàè‰∏ªÂØπË±°
        const game = {
            // Ê∏∏ÊàèÁä∂ÊÄÅ
            isRunning: false,
            isBraking: false,
            speed: 0,
            maxSpeed: 10,
            acceleration: 0.05,
            deceleration: 0.1,
            brakeDeceleration: 0.3,
            distance: 0,
            score: 0,
            successfulStops: 0,
            totalStops: 0,
            trainPosition: 50,
            stopZonePosition: 0,
            animationId: null,
            currentSpeedSetting: 5,
            
            // DOM ÂÖÉÁ¥†
            elements: {
                train: null,
                startBtn: null,
                stopBtn: null,
                brakeBtn: null,
                resetBtn: null,
                speedControl: null,
                speedValue: null,
                distanceValue: null,
                scoreValue: null,
                accuracyValue: null,
                accuracyBox: null
            },
            
            // ÂàùÂßãÂåñÊ∏∏Êàè
            init() {
                // Ëé∑ÂèñDOMÂÖÉÁ¥†
                this.elements.train = document.getElementById('train');
                this.elements.startBtn = document.getElementById('start-btn');
                this.elements.stopBtn = document.getElementById('stop-btn');
                this.elements.brakeBtn = document.getElementById('brake-btn');
                this.elements.resetBtn = document.getElementById('reset-btn');
                this.elements.speedControl = document.getElementById('speed-control');
                this.elements.speedValue = document.getElementById('speedValue');
                this.elements.distanceValue = document.getElementById('distanceValue');
                this.elements.scoreValue = document.getElementById('scoreValue');
                this.elements.accuracyValue = document.getElementById('accuracyValue');
                this.elements.accuracyBox = document.getElementById('accuracy-box');
                
                // ËÆ°ÁÆóÂÅúËΩ¶Âå∫Âüü‰ΩçÁΩÆ
                const stopZone = document.getElementById('stop-zone');
                this.stopZonePosition = document.getElementById('game-area').offsetWidth - 
                                         stopZone.offsetLeft - 
                                         stopZone.offsetWidth / 2;
                
                // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.setupEventListeners();
            },
            
            // ËÆæÁΩÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
            setupEventListeners() {
                this.elements.startBtn.addEventListener('click', () => this.startGame());
                this.elements.stopBtn.addEventListener('click', () => this.stopTrain());
                this.elements.brakeBtn.addEventListener('click', () => this.brake());
                this.elements.resetBtn.addEventListener('click', () => this.resetGame());
                this.elements.speedControl.addEventListener('input', (e) => {
                    this.currentSpeedSetting = parseInt(e.target.value);
                });
                
                // Ê∑ªÂä†ÁÇπÂáªÂáÜÁ°ÆÁéáÂå∫ÂüüÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                this.elements.accuracyBox.addEventListener('click', () => {
                    this.showSuccessModal();
                });
            },
            
            // ÂºÄÂßãÊ∏∏Êàè
            startGame() {
                if (!this.isRunning) {
                    this.isRunning = true;
                    this.elements.startBtn.disabled = true;
                    this.elements.stopBtn.disabled = false;
                    this.elements.brakeBtn.disabled = false;
                    this.elements.speedControl.disabled = false;
                    
                    // ËÆæÁΩÆÁõÆÊ†áÈÄüÂ∫¶
                    this.maxSpeed = this.currentSpeedSetting;
                    
                    // ÂºÄÂßãÊ∏∏ÊàèÂæ™ÁéØ
                    this.gameLoop();
                }
            },
            
            // ÂÅúÊ≠¢ÂàóËΩ¶
            stopTrain() {
                if (this.isRunning) {
                    this.totalStops++;
                    const distanceToStop = Math.abs(this.distance - this.stopZonePosition);
                    
                    if (distanceToStop <= 30) { // Âú®ÂÅúËΩ¶Âå∫ÂüüÂÜÖ
                        const points = Math.max(0, 100 - distanceToStop * 2);
                        this.score += points;
                        this.successfulStops++;
                    }
                    
                    this.isRunning = false;
                    this.isBraking = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.stopBtn.disabled = true;
                    this.elements.brakeBtn.disabled = true;
                    this.elements.speedControl.disabled = true;
                    
                    this.updateScore();
                }
            },
            
            // ÂàπËΩ¶
            brake() {
                if (this.isRunning && !this.isBraking) {
                    this.isBraking = true;
                }
            },
            
            // ÈáçÁΩÆÊ∏∏Êàè
            resetGame() {
                this.stopGameLoop();
                
                this.isRunning = false;
                this.isBraking = false;
                this.speed = 0;
                this.distance = 0;
                this.trainPosition = 50;
                
                this.elements.train.style.transform = `translateX(${this.trainPosition}px)`;
                this.elements.startBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                this.elements.brakeBtn.disabled = true;
                this.elements.speedControl.disabled = true;
                
                this.updateDisplay();
            },
            
            // Ê∏∏Êàè‰∏ªÂæ™ÁéØ
            gameLoop() {
                // Êõ¥Êñ∞ÈÄüÂ∫¶
                if (this.isRunning) {
                    if (this.isBraking) {
                        // ÂàπËΩ¶ÂáèÈÄü
                        this.speed = Math.max(0, this.speed - this.brakeDeceleration);
                    } else {
                        // Âä†ÈÄüÂà∞ÁõÆÊ†áÈÄüÂ∫¶
                        this.speed = Math.min(this.maxSpeed, this.speed + this.acceleration);
                    }
                }
                
                // Êõ¥Êñ∞‰ΩçÁΩÆ
                this.distance += this.speed;
                this.trainPosition = 50 + this.distance / 5; // Áº©ÊîæÂõ†Â≠ê‰ΩøÁßªÂä®Êõ¥ÊòéÊòæ
                this.elements.train.style.transform = `translateX(${this.trainPosition}px)`;
                
                // Ê£ÄÊü•ÊòØÂê¶ÈÄöËøáËΩ¶Á´ô
                if (this.distance > this.stopZonePosition + 100 && this.isRunning) {
                    this.totalStops++;
                    this.updateScore();
                    this.isRunning = false;
                    this.isBraking = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.stopBtn.disabled = true;
                    this.elements.brakeBtn.disabled = true;
                }
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                this.updateDisplay();
                
                // ÁªßÁª≠Âæ™ÁéØ
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            },
            
            // ÂÅúÊ≠¢Ê∏∏ÊàèÂæ™ÁéØ
            stopGameLoop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            },
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateDisplay() {
                this.elements.speedValue.textContent = this.speed.toFixed(1);
                this.elements.distanceValue.textContent = `${Math.round(this.distance)}m`;
            },
            
            // Êõ¥Êñ∞ÂàÜÊï∞ÂíåÂáÜÁ°ÆÁéá
            updateScore() {
                this.elements.scoreValue.textContent = this.score;
                const accuracy = this.totalStops > 0 ? Math.floor((this.successfulStops / this.totalStops) * 100) : 0;
                this.elements.accuracyValue.textContent = `${accuracy}%`;
                
                // Ê£ÄÊü•ÊòØÂê¶ÈÄöÂÖ≥
                if (accuracy >= 80 && this.totalStops >= 2) {
                    this.showSuccessModal();
                }
            },
            
            // ÊòæÁ§∫ÈÄöÂÖ≥ÂºπÁ™ó
            showSuccessModal() {
                const modal = document.getElementById('success-modal');
                modal.style.display = 'flex';
                
                // ÁÇπÂáªÂÖ≥Èó≠ÊåâÈíÆ
                document.getElementById('close-modal').addEventListener('click', () => {
                    modal.style.display = 'none';
                });
            }
        };

        // ÂêØÂä®Ê∏∏Êàè
        window.onload = () => game.init();

        // Á°Æ‰øùÊ∏∏ÊàèÂæ™ÁéØÂú®È°µÈù¢Âç∏ËΩΩÊó∂ÂÅúÊ≠¢
        window.addEventListener('beforeunload', () => {
            game.stopGameLoop();
        });
    </script>
</body>
</html>
