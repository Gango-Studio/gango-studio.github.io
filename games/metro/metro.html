<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html style="filter: grayscale(0%);" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train Simulator - Yamanote Line</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        :root {
            --jr-green: #00a160;
            --jr-orange: #f39800;
            --jr-blue: #0095d9;
            --jr-gray: #e6e6e6;
            --jr-dark: #333333;
            --jr-dark-bg: #424242;
            --jr-light-bg: #f5f5f5;
            --jr-red: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Helvetica Neue', Arial, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background-color: var(--jr-light-bg);
            color: var(--jr-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* 页眉样式 */
        header {
            background-color: var(--jr-green);
            color: white;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        header h1 {
            font-size: 24px;
            font-weight: bold;
            margin: 0;
            color: white;
        }

        /* 游戏容器样式 */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: transparent;
            flex: 1;
        }

        /* 游戏区域样式 */
        #game-area {
            position: relative;
            width: 100%;
            height: 300px;
            background-color: #333;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        #train {
            position: absolute;
            width: 150px;
            height: 50px;
            background-color: var(--jr-green);
            bottom: 50px;
            left: 50px;
            transition: transform 0.1s ease;
        }

        #station {
            position: absolute;
            width: 20px;
            height: 100px;
            background-color: white;
            bottom: 0;
            right: 200px;
        }

        #stop-zone {
            position: absolute;
            width: 60px;
            height: 10px;
            background-color: rgba(255, 255, 255, 0.5);
            bottom: 50px;
            right: 190px;
        }

        /* 控制按钮样式 */
        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background-color: var(--jr-gray);
            color: white;
            border: none;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        #start-btn {
            background-color: var(--jr-orange);
        }

        #stop-btn {
            background-color: var(--jr-red);
        }

        #brake-btn {
            background-color: var(--jr-green);
        }

        #reset-btn {
            background-color: var(--jr-blue);
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* 速度控制条样式 */
        #speed-control {
            width: 100%;
            margin-bottom: 20px;
            -webkit-appearance: none;
            height: 8px;
            background: var(--jr-gray);
            border-radius: 4px;
            outline: none;
        }

        #speed-control::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--jr-green);
            cursor: pointer;
        }

        #speed-control::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--jr-green);
            cursor: pointer;
        }

        /* 统计信息样式 */
        #stats {
            display: flex;
            justify-content: space-around;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .stat-box {
            text-align: center;
            flex: 1;
            padding: 10px;
        }

        .stat-box h3 {
            margin: 0 0 5px;
            color: #666;
            font-size: 14px;
        }

        .stat-box p {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
        }

        #speedValue {
            color: var(--jr-orange);
        }

        #distanceValue {
            color: var(--jr-blue);
        }

        #scoreValue {
            color: var(--jr-green);
        }

        .accuracy-clickable {
            cursor: pointer;
        }

        /* 通关弹窗样式 */
        #success-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        #success-content {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            max-width: 80%;
            text-align: center;
        }
        
        #success-image {
            max-width: 100%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        #close-modal {
            background-color: var(--jr-green);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* 页脚样式 */
        footer {
            background-color: var(--jr-dark-bg);
            color: white;
            padding: 30px 20px;
            margin-top: auto;
        }
        
        footer h3 {
            color: var(--jr-green);
            font-size: 20px;
            margin-bottom: 15px;
            width: 100%;
            text-align: center;
        }
        
        footer div {
            flex: 1;
            min-width: 150px;
            margin: 10px 0;
            text-align: center;
        }
        
        footer h4, footer h5 {
            margin: 8px 0;
        }
        
        footer a {
            color: white;
            text-decoration: none;
            display: inline-block;
            padding: 3px 0;
            transition: color 0.3s;
        }
        
        footer a:hover {
            color: var(--jr-green);
        }
        
        @media (max-width: 768px) {
            footer div {
                min-width: 100%;
                margin: 5px 0;
            }
            
            #controls {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            button {
                width: 70px;
                height: 70px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="https://gango-studio.github.io">
            <h1>Train Simulator - Yamanote Line</h1>
        </a>
    </header>

    <div class="game-container">
        <div id="game-area">
            <div id="train"></div>
            <div id="station"></div>
            <div id="stop-zone"></div>
        </div>

        <div id="controls">
            <button id="start-btn">Start</button>
            <button id="stop-btn" disabled>Stop</button>
            <button id="brake-btn" disabled>Brake</button>
            <button id="reset-btn">Reset</button>
        </div>

        <input type="range" id="speed-control" min="1" max="10" value="5" disabled>

        <div id="stats">
            <div class="stat-box">
                <h3>Speed</h3>
                <p id="speedValue">0</p>
            </div>
            <div class="stat-box">
                <h3>Distance</h3>
                <p id="distanceValue">0m</p>
            </div>
            <div class="stat-box">
                <h3>Score</h3>
                <p id="scoreValue">0</p>
            </div>
            <div class="stat-box accuracy-clickable" id="accuracy-box">
                <h3>Accuracy</h3>
                <p id="accuracyValue">0%</p>
            </div>
        </div>
    </div>

    <!-- 通关弹窗 -->
    <div id="success-modal">
        <div id="success-content">
            <h2>Congratulations!</h2>
            <p>You've achieved high-precision stopping!</p>
            <img id="success-image" src="../pic/metro.jpg" alt="Success Image">
            <button id="close-modal">Close</button>
        </div>
    </div>

    <footer>
        <h3>Gango Studio</h3>
        <div>
            <h4><a href="https://gango-studio.github.io">🏠Home</a></h4>
            <h5><a href="https://gango-studio.github.io/main.html">🔗Vlog</a></h5>
            <h5><a href="https://gango-studio.github.io/introduce/cfile.html">🔗C++</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/tools/indexpage.html">🔗Gango Weather</a></h5>
        </div>
        <div>
            <h5><a href="https://gango-studio.github.io/introduce/blog.html">🔗Blog</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/blank.html">🔗Browser Home</a></h5>
            <h5><a href="https://gango-studio.github.io/serves/tools/indexpage.html">🔗Gango Tool</a></h5>
            <h5>&nbsp;<a></a></h5>
        </div>
    </footer>

    <script>
        // 游戏主对象
        const game = {
            // 游戏状态
            isRunning: false,
            isBraking: false,
            speed: 0,
            maxSpeed: 10,
            acceleration: 0.05,
            deceleration: 0.1,
            brakeDeceleration: 0.3,
            distance: 0,
            score: 0,
            successfulStops: 0,
            totalStops: 0,
            trainPosition: 50,
            stopZonePosition: 0,
            animationId: null,
            currentSpeedSetting: 5,
            
            // DOM 元素
            elements: {
                train: null,
                startBtn: null,
                stopBtn: null,
                brakeBtn: null,
                resetBtn: null,
                speedControl: null,
                speedValue: null,
                distanceValue: null,
                scoreValue: null,
                accuracyValue: null,
                accuracyBox: null
            },
            
            // 初始化游戏
            init() {
                // 获取DOM元素
                this.elements.train = document.getElementById('train');
                this.elements.startBtn = document.getElementById('start-btn');
                this.elements.stopBtn = document.getElementById('stop-btn');
                this.elements.brakeBtn = document.getElementById('brake-btn');
                this.elements.resetBtn = document.getElementById('reset-btn');
                this.elements.speedControl = document.getElementById('speed-control');
                this.elements.speedValue = document.getElementById('speedValue');
                this.elements.distanceValue = document.getElementById('distanceValue');
                this.elements.scoreValue = document.getElementById('scoreValue');
                this.elements.accuracyValue = document.getElementById('accuracyValue');
                this.elements.accuracyBox = document.getElementById('accuracy-box');
                
                // 计算停车区域位置
                const stopZone = document.getElementById('stop-zone');
                this.stopZonePosition = document.getElementById('game-area').offsetWidth - 
                                         stopZone.offsetLeft - 
                                         stopZone.offsetWidth / 2;
                
                // 设置事件监听器
                this.setupEventListeners();
            },
            
            // 设置事件监听器
            setupEventListeners() {
                this.elements.startBtn.addEventListener('click', () => this.startGame());
                this.elements.stopBtn.addEventListener('click', () => this.stopTrain());
                this.elements.brakeBtn.addEventListener('click', () => this.brake());
                this.elements.resetBtn.addEventListener('click', () => this.resetGame());
                this.elements.speedControl.addEventListener('input', (e) => {
                    this.currentSpeedSetting = parseInt(e.target.value);
                });
                
                // 添加点击准确率区域的事件监听器
                this.elements.accuracyBox.addEventListener('click', () => {
                    this.showSuccessModal();
                });
            },
            
            // 开始游戏
            startGame() {
                if (!this.isRunning) {
                    this.isRunning = true;
                    this.elements.startBtn.disabled = true;
                    this.elements.stopBtn.disabled = false;
                    this.elements.brakeBtn.disabled = false;
                    this.elements.speedControl.disabled = false;
                    
                    // 设置目标速度
                    this.maxSpeed = this.currentSpeedSetting;
                    
                    // 开始游戏循环
                    this.gameLoop();
                }
            },
            
            // 停止列车
            stopTrain() {
                if (this.isRunning) {
                    this.totalStops++;
                    const distanceToStop = Math.abs(this.distance - this.stopZonePosition);
                    
                    if (distanceToStop <= 30) { // 在停车区域内
                        const points = Math.max(0, 100 - distanceToStop * 2);
                        this.score += points;
                        this.successfulStops++;
                    }
                    
                    this.isRunning = false;
                    this.isBraking = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.stopBtn.disabled = true;
                    this.elements.brakeBtn.disabled = true;
                    this.elements.speedControl.disabled = true;
                    
                    this.updateScore();
                }
            },
            
            // 刹车
            brake() {
                if (this.isRunning && !this.isBraking) {
                    this.isBraking = true;
                }
            },
            
            // 重置游戏
            resetGame() {
                this.stopGameLoop();
                
                this.isRunning = false;
                this.isBraking = false;
                this.speed = 0;
                this.distance = 0;
                this.trainPosition = 50;
                
                this.elements.train.style.transform = `translateX(${this.trainPosition}px)`;
                this.elements.startBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                this.elements.brakeBtn.disabled = true;
                this.elements.speedControl.disabled = true;
                
                this.updateDisplay();
            },
            
            // 游戏主循环
            gameLoop() {
                // 更新速度
                if (this.isRunning) {
                    if (this.isBraking) {
                        // 刹车减速
                        this.speed = Math.max(0, this.speed - this.brakeDeceleration);
                    } else {
                        // 加速到目标速度
                        this.speed = Math.min(this.maxSpeed, this.speed + this.acceleration);
                    }
                }
                
                // 更新位置
                this.distance += this.speed;
                this.trainPosition = 50 + this.distance / 5; // 缩放因子使移动更明显
                this.elements.train.style.transform = `translateX(${this.trainPosition}px)`;
                
                // 检查是否通过车站
                if (this.distance > this.stopZonePosition + 100 && this.isRunning) {
                    this.totalStops++;
                    this.updateScore();
                    this.isRunning = false;
                    this.isBraking = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.stopBtn.disabled = true;
                    this.elements.brakeBtn.disabled = true;
                }
                
                // 更新显示
                this.updateDisplay();
                
                // 继续循环
                this.animationId = requestAnimationFrame(() => this.gameLoop());
            },
            
            // 停止游戏循环
            stopGameLoop() {
                if (this.animationId) {
                    cancelAnimationFrame(this.animationId);
                    this.animationId = null;
                }
            },
            
            // 更新显示
            updateDisplay() {
                this.elements.speedValue.textContent = this.speed.toFixed(1);
                this.elements.distanceValue.textContent = `${Math.round(this.distance)}m`;
            },
            
            // 更新分数和准确率
            updateScore() {
                this.elements.scoreValue.textContent = this.score;
                const accuracy = this.totalStops > 0 ? Math.floor((this.successfulStops / this.totalStops) * 100) : 0;
                this.elements.accuracyValue.textContent = `${accuracy}%`;
                
                // 检查是否通关
                if (accuracy >= 80 && this.totalStops >= 2) {
                    this.showSuccessModal();
                }
            },
            
            // 显示通关弹窗
            showSuccessModal() {
                const modal = document.getElementById('success-modal');
                modal.style.display = 'flex';
                
                // 点击关闭按钮
                document.getElementById('close-modal').addEventListener('click', () => {
                    modal.style.display = 'none';
                });
            }
        };

        // 启动游戏
        window.onload = () => game.init();

        // 确保游戏循环在页面卸载时停止
        window.addEventListener('beforeunload', () => {
            game.stopGameLoop();
        });
    </script>
</body>
</html>
